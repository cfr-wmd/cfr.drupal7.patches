--- includes/bootstrap.inc      2015-03-18 15:20:37.000000000 -0400
+++ includes/fa.bootstrap.inc   2015-04-22 16:54:01.481031278 -0400
@@ -2949,6 +2949,11 @@
 
         // Eliminate all trusted IPs.
         $untrusted = array_diff($forwarded, $reverse_proxy_addresses);
+        
+        // If configured, eliminate more trusted IPs.
+        if (!empty($GLOBALS['conf']['fa_reverse_proxy_addresses_number_to_eliminate'])) {
+          $untrusted = array_slice($untrusted, 0, -((int) $GLOBALS['conf']['fa_reverse_proxy_addresses_number_to_eliminate']));
+        }
 
         // The right-most IP is the most specific we can trust.
         $ip_address = array_pop($untrusted);
